import * as _ from 'lodash';

import { BackButtonDest, ButtonColor, ButtonPayload, Keyboard, KeyboardButton } from './types';
import { genreNames, GENRES_BUTTONS } from './constants';

export const backButtonText: Record<BackButtonDest, string> = {
  [BackButtonDest.MAIN]: '–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
  [BackButtonDest.POSTER]: '–ê—Ñ–∏—à–∞',
  [BackButtonDest.FOR_MUSICIANS]: '–î–ª—è –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤',
};

export const mainKeyboard: Keyboard = {
  one_time: false,
  buttons: [
    [
      generateButton('–ê—Ñ–∏—à–∞', { command: 'poster' }),
      generateButton('–ü–ª–µ–π–ª–∏—Å—Ç—ã', { command: 'playlist' }),
    ],
    [
      generateButton('–¢–µ–∫—Å—Ç–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã', { command: 'text_materials' }),
      generateButton('–†–µ–ª–∏–∑—ã', { command: 'releases' }),
    ],
    [
      generateButton('–î–ª—è –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤', { command: 'for_musicians' }),
    ],
    [
      generateButton('üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É', { command: 'refresh_keyboard' }, ButtonColor.POSITIVE),
    ],
  ]
};

export const genresKeyboard: Keyboard = {
  one_time: false,
  buttons: [
    ...GENRES_BUTTONS.map((buttons) => (
      buttons.map((genre) => generateButton(_.upperFirst(genreNames[genre]), { command: 'poster_genre', genre }))
    )),
    [generateBackButton(BackButtonDest.POSTER)],
    [generateBackButton()],
  ]
};

export const servicesKeyboard: Keyboard = {
  one_time: false,
  buttons: [
    [
      generateButton('–î–∏–∑–∞–π–Ω —Å—Ç–∏–∫–µ—Ä–æ–≤', { command: 'service', serviceId: 'market-177574047_3113786' }),
      generateButton('–†–µ–∫–ª–∞–º–∞ –≤ Soundcheck', { command: 'service', serviceId: 'market-177574047_2685381' }),
    ],
    [generateBackButton(BackButtonDest.FOR_MUSICIANS)],
    [generateBackButton()],
  ]
};

export const textMaterialsKeyboard: Keyboard = {
  one_time: false,
  buttons: [
    [
      generateButton('–õ–æ–Ω–≥—Ä–∏–¥—ã', { command: 'longread' }),
      generateButton('–ò—Å—Ç–æ—Ä–∏–∏ –≥—Ä—É–ø–ø', { command: 'group_history' }),
    ],
    [generateBackButton()],
  ]
};

export const forMusiciansKeyboard: Keyboard = {
  one_time: false,
  buttons: [
    [generateButton('–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –≥—Ä—É–ø–ø–µ', { command: 'tell_about_group' })],
    [generateButton('–°–æ–æ–±—â–∏—Ç—å –æ —Ä–µ–ª–∏–∑–µ', { command: 'tell_about_release' })],
    [generateButton('–£—Å–ª—É–≥–∏', { command: 'services' })],
    [generateBackButton()],
  ]
};

export function generateButton(text: string, payload: ButtonPayload, color: ButtonColor = ButtonColor.PRIMARY): KeyboardButton {
  return {
    action: {
      type: 'text',
      label: text,
      payload: JSON.stringify(payload)
    },
    color,
  };
}

export function generateBackButton(dest: BackButtonDest = BackButtonDest.MAIN): KeyboardButton {
  return generateButton(`‚Üê ${backButtonText[dest]}`, { command: 'back', dest }, ButtonColor.SECONDARY);
}
